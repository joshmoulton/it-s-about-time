import React from 'npm:react@18.3.1'
import { Webhook } from 'https://esm.sh/standardwebhooks@1.0.0'
import { Resend } from 'npm:resend@4.0.0'
import { renderAsync } from 'npm:@react-email/components@0.0.22'
import { SignupConfirmationEmail } from './_templates/signup-confirmation.tsx'
import { MagicLinkEmail } from './_templates/magic-link.tsx'

const resend = new Resend(Deno.env.get('RESEND_API_KEY') as string)
const hookSecret = Deno.env.get('AUTH_EMAIL_HOOK_SECRET') as string

const corsHeaders = {
  "Access-Control-Allow-Origin": "*",
  "Access-Control-Allow-Headers": "authorization, x-client-info, apikey, content-type",
}

Deno.serve(async (req) => {
  // Handle CORS preflight requests
  if (req.method === "OPTIONS") {
    return new Response(null, { headers: corsHeaders });
  }

  // COMPLETELY DISABLE AUTH EMAILS - We use custom send-magic-link function instead
  console.log('ðŸš« Auth emails webhook disabled - redirecting to custom magic link system');
  
  return new Response(JSON.stringify({ 
    success: true, 
    message: 'Auth emails disabled - using custom magic link system',
    disabled: true
  }), {
    status: 200,
    headers: { 'Content-Type': 'application/json', ...corsHeaders },
  })
})